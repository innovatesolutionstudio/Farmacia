<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Productos - Farmacia</title>
    <link rel="stylesheet" href="/resources/css/paginapedidos.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos para el popup del carrito */
        #cart-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 20px;
            z-index: 1000;
        }

        #cart-popup .cart-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .cart-item-title {
            font-weight: bold;
        }

        .cart-item-price {
            color: #333;
        }

        #cart-popup .cart-item-quantity {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-quantity button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px;
            cursor: pointer;
        }

        .cart-item-quantity span {
            margin: 0 10px;
        }

        .cart-item-quantity button:hover {
            background-color: #45a049;
        }

        .close-popup {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 50%;
        }

        .close-popup:hover {
            background-color: #da190b;
        }

        /* Estilo del fondo del popup */
        #cart-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 999;
        }
        /* Estilos para el popup del perfil */
.perfil-popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    background-color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    padding: 20px;
    z-index: 1000;
}

.perfil-popup h3 {
    text-align: center;
}

.close-popup {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: #f44336;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 50%;
}

.close-popup:hover {
    background-color: #da190b;
}

/* Estilo del fondo del popup */
.perfil-popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    z-index: 999;
}

    </style>
</head>
<body>
    <div class="top-header">
        <a href="/pagina_pedidos/index_clientes/:idSucursal" class="logo">
            <img src="/resources/images/iconos/farmacia.ico" alt="Farmacia 25 de Julio">
        </a>    
        <ul>
            <li><a href="/pagina_pedidos/index_clientes/:idSucursal" class="dropdown">Inicio</a></li>
            <li><a href="/pagina_pedidos/productos/:idSucursal" class="dropdown">Tienda</a></li>

            
            <li><a href="/pagina_pedidos/consultas" class="dropdown">Consultas</a></li>
            <li><a href="/pagina_pedidos/miscompras" class="dropdown">Compras</a></li>
            <li><a href="/pagina_pedidos/recordatorio" class="dropdown">Recordatorio</a></li>
        </ul>
        <a class="cart-icon" onclick="mostrarCarrito(); return false;">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count">0</span>
        </a>

        <!-- Selector de Sucursales -->
        <select name="sucursal" id="sucursal" class="location-select" onchange="cambiarSucursal()">
            <% results.forEach(sucursal => { %>
                <option value="<%= sucursal.ID_Sucursal %>" <%= idSucursal == sucursal.ID_Sucursal ? 'selected' : '' %>><%= sucursal.Nombre %></option>
            <% }); %>
        </select>
        <!-- Botón de Perfil del Usuario -->
        <a href="#" class="profile-icon" onclick="mostrarPerfil(); return false;">
            <i class="fas fa-user"></i> <span class="profile-name">Perfil</span>
        </a>
    </div>
            <!-- Popup del Perfil -->
            <div id="perfil-popup" class="perfil-popup">
                <button class="close-popup" onclick="cerrarPerfil()">×</button>
                <h3>Perfil del Usuario</h3>
                <p>Nombre: <span id="user-name">John Doe</span></p>
                <p>Email: <span id="user-email">johndoe@example.com</span></p>
                <p><button onclick="editarPerfil()">Editar Perfil</button></p>
            </div>
            <div id="perfil-popup-overlay" class="perfil-popup-overlay"></div>
    <header>
        <div class="left-content">
            <h1>¡Bienvenido a nuestra Farmacia en Línea!</h1>
            <p>Explora nuestras opciones y no dudes en consultarnos cualquier inquietud. Estamos listos para ayudarte.</p>
        <!-- Botón de Comprar -->
        <button class="btn-buy" onclick="window.location.href='/pagina_pedidos/login_clientes'">Comprar</button>
        </div>
    </header>   
    <div class="services-section">
        <h2>Nuestros Servicios</h2>
        <div class="services-container">
            <a href="/pagina_pedidos/consultas" class="service-card">
                <div class="service-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <h3>Realiza Consultas</h3>
                <p>24h</p>
            </a>
            <a href="/pagina_pedidos/productos" class="service-card">
                <div class="service-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <h3>Pedidos</h3>
                <p>Coordina Tu Pedido</p>
            </a>
            <a href="/pagina_pedidos/recordatorio" class="service-card">
                <div class="service-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <h3>Recordatorio</h3>
                <p>No Olvides Tomar Tu Pastilla</p>
            </a>
        </div>
    </div>
    
    <!-- Sección de contacto al final -->
    <div class="contact-container">
        <div class="social-media">
            <!-- Aquí irían los enlaces a redes sociales -->
        </div>
        <div class="contact-info">
            <h2>Contacto</h2>
            <p>Si tienes alguna duda, por favor contacta con nosotros:</p>
            <p><strong>Horario de Atención:</strong> Lunes a Viernes, 9:00 - 18:00</p>
            <p><strong>Teléfono:</strong> +34 123 456 789</p>
            <p><strong>Correo Electrónico:</strong> contacto@ejemplo.com</p>
        </div>
    </div>

    <!-- Popup del Carrito -->
    <div id="cart-popup-overlay" onclick="cerrarCarrito()"></div>
    <div id="cart-popup">
        <button class="close-popup" onclick="cerrarCarrito()">×</button>
        <h3>Carrito de Compras</h3>
        <ul id="cart-items"></ul>
        <button onclick="realizarCompra()">Ir a comprar</button>
    </div>

    <script>
        // Función para cambiar la sucursal seleccionada y redirigir al usuario
        function cambiarSucursal() {
            const sucursalId = document.getElementById('sucursal').value;
            window.location.href = `/pagina_pedidos/index_clientes/${sucursalId}`;
        }

        // Inicialización del carrito desde localStorage
        let carrito = JSON.parse(localStorage.getItem('cart')) || [];

        // Función para agregar productos al carrito
        function agregarAlCarrito(productId, nombre, precio) {
            const productoExistente = carrito.find(item => item.id === productId);

            if (productoExistente) {
                productoExistente.quantity += 1; // Aumenta la cantidad si ya existe
            } else {
                carrito.push({
                    id: productId,
                    name: nombre,
                    price: precio,
                    quantity: 1
                });
            }

            localStorage.setItem('cart', JSON.stringify(carrito)); // Guarda el carrito actualizado en el almacenamiento local
            mostrarCarrito(); // Muestra el carrito
            actualizarContadorCarrito(); // Actualiza el contador de productos en el carrito
        }

        // Función para mostrar el carrito
        function mostrarCarrito() {
            const carritoPopup = document.getElementById('cart-popup');
            const listaCarrito = document.getElementById('cart-items');
            listaCarrito.innerHTML = '';

            carrito.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-price">$${item.price}</div>
                    </div>
                    <div class="cart-item-quantity">
                        <button class="quantity-btn" onclick="cambiarCantidad('${item.id}', -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="cambiarCantidad('${item.id}', 1)">+</button>
                    </div>
                `;
                listaCarrito.appendChild(li);
            });

            document.getElementById('cart-popup-overlay').style.display = 'block'; // Muestra el fondo
            carritoPopup.style.display = 'block'; // Muestra el popup
        }

        // Función para cambiar la cantidad de productos en el carrito
        function cambiarCantidad(productId, cambio) {
            const item = carrito.find(item => item.id === productId);

            if (item) {
                item.quantity += cambio;

                if (item.quantity <= 0) {
                    carrito = carrito.filter(item => item.id !== productId); // Elimina el producto si la cantidad es 0 o menor
                }

                localStorage.setItem('cart', JSON.stringify(carrito)); // Actualiza el carrito en localStorage
                mostrarCarrito(); // Actualiza la vista del carrito
                actualizarContadorCarrito(); // Actualiza el contador del carrito
            }
        }

        // Función para cerrar el carrito
        function cerrarCarrito() {
            document.getElementById('cart-popup').style.display = 'none'; // Oculta el popup
            document.getElementById('cart-popup-overlay').style.display = 'none'; // Oculta el fondo
        }

        // Actualiza el contador de productos en el carrito
        function actualizarContadorCarrito() {
            const contador = document.querySelector('.cart-count');
            contador.textContent = carrito.length; // Muestra el número de productos en el carrito
        }

        // Llama a la función para inicializar el contador del carrito cuando se carga la página
        actualizarContadorCarrito();

        // Función para realizar la compra
        function realizarCompra() {
            window.location.href = '/pagina_pedidos/productos/:idSucursal'; // Redirige a la página de compra
        }
        // Función para mostrar el popup del perfil
        function mostrarPerfil() {
            document.getElementById('perfil-popup').style.display = 'block';
            document.getElementById('perfil-popup-overlay').style.display = 'block';
        }

        // Función para cerrar el popup del perfil
        function cerrarPerfil() {
            document.getElementById('perfil-popup').style.display = 'none';
            document.getElementById('perfil-popup-overlay').style.display = 'none';
        }

        // Función para editar el perfil (redirige a una nueva vista)
        function editarPerfil() {
            // Redirige a la página de edición del perfil (cambia la ruta según tu proyecto)
            window.location.href = '/pagina_pedidos/perfil';  // Ruta del formulario de edición
        }


    </script>
</body>
</html>
